\documentclass[10pt, letterpaper]{article}
\usepackage[utf8]{inputenc}

\usepackage[
    left=0.75in,
    right=0.75in,
    top=0.75in,
    bottom=0.75in,
    headheight=0pt,
    footskip=0pt
]{geometry}

\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}

\usepackage{ragged2e}
\usepackage{titlesec}
\titleformat{\section}{\Large\bfseries\scshape\RaggedRight}{}{0em}{}[\vspace{-0.1em}\rule{\linewidth}{0.8pt}\vspace{-0.1em}]
\titlespacing*{\section}{0pt}{*1.5}{*0.5}

\usepackage{enumitem}
\setlist{nosep, itemsep=0.0em, parsep=0.0em, topsep=0.1em, partopsep=0em}
\setlist[itemize]{leftmargin=1.5em,label=\textbullet}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    urlcolor=blue,
    linkcolor=black,
    citecolor=black
}

\usepackage{fontawesome5}

% --- Custom Commands for Resume Elements ---
\newcommand{\rsubtitle}[2]{%
    \vspace{0.1em}\normalsize{\textbf{#1}} \hfill \normalsize{#2}\par
}

\newcommand{\rcompany}[1]{%
    \normalsize{\textit{#1}}\par
    \vspace{-0.1em}
}

\newcommand{\rbullet}[1]{%
    \item \small{#1}
}

\newcommand{\rinlinelists}[1]{%
    \small{#1}\par\vspace{0.5em}
}

\newcommand{\rhorizontalbullets}[1]{%
    \small{#1}\par\vspace{0.5em}
}

\newcommand{\rdynamiccolumns}[2]{%
    \small
    \begin{tabular}{#1}
        #2
    \end{tabular}
    \par\vspace{0.5em}
}

\begin{document}

% --- Header ---
\begin{center}
    \textbf{\Huge{\VAR{contact_info.name}}} \\
    \vspace{0.05em}
    \normalsize{%
        \faMapMarker \hspace{2pt} \VAR{contact_info.location} \textbullet\
        \faPhone \hspace{2pt} \VAR{contact_info.phone} \textbullet\
        \faEnvelope \hspace{2pt} \href{mailto:\VAR{contact_info.email}}{\VAR{contact_info.email}} \textbullet\
        \faLinkedin \hspace{2pt} \href{\VAR{contact_info.linkedin}}{\VAR{contact_info.linkedin_handle}}%
    }
\end{center}
\vspace{0.1em}

% --- Sections ---
\BLOCK{for section in sections}
    \BLOCK{set section_type = section.get('type', '').lower()}
    \BLOCK{if not section_type}
        \BLOCK{if section.name|lower == "experience"}
            \BLOCK{set section_type = "experience"}
        \BLOCK{elif section.name|lower == "education"}
            \BLOCK{set section_type = "education"}
        \BLOCK{endif}
    \BLOCK{endif}
    \section*{\VAR{section.name}}

    \BLOCK{if section_type == "text"}
        \small{\VAR{section.content}}\vspace{0.5em}

    \BLOCK{elif section_type == "bulleted-list"}
        \begin{itemize}[leftmargin=1.5em,label=\textbullet,itemsep=0.1em,parsep=0pt]
            \BLOCK{for item in section.content}
                \rbullet{\VAR{item}}
            \BLOCK{endfor}
        \end{itemize}\vspace{0.5em}

    \BLOCK{elif section_type == "inline-list"}
        \rhorizontalbullets{\VAR{" \\textbullet\\ ".join(section.content)}}

    \BLOCK{elif section_type == "dynamic-column-list"}
        \BLOCK{set num_cols = section.get('num_cols', 1)}
        \BLOCK{set items = section.content}
        % DEBUG: Section '\VAR{section.name}' has \VAR{items|length} items, using \VAR{num_cols} columns
        \BLOCK{set items_per_row = (items|length / num_cols)|round(0, 'ceil')|int}
        \BLOCK{set col_spec = 'l@{\\hspace{1em}}' * (num_cols - 1) + 'l'}
        \small
        \begin{tabular}{\VAR{col_spec}}
            \BLOCK{for row in range(items_per_row)}
                \BLOCK{set row_items = []}
                \BLOCK{for col in range(num_cols)}
                    \BLOCK{set item_index = row * num_cols + col}
                    \BLOCK{if item_index < items|length}
                        \BLOCK{set _ = row_items.append(items[item_index])}
                    \BLOCK{else}
                        \BLOCK{set _ = row_items.append('~')}
                    \BLOCK{endif}
                \BLOCK{endfor}
                \VAR{' & '.join(row_items)} \\
            \BLOCK{endfor}
        \end{tabular}
        \par\vspace{0.5em}

    \BLOCK{elif section_type == "icon-list"}
        \begin{itemize}[leftmargin=1.5em,label=\textbullet,itemsep=0.1em,parsep=0pt]
            \BLOCK{for item in section.content}
                \BLOCK{if item is mapping}
                    \rbullet{\VAR{item.certification} (\VAR{item.issuer}, \VAR{item.date})}
                \BLOCK{else}
                    \rbullet{\VAR{item}}
                \BLOCK{endif}
            \BLOCK{endfor}
        \end{itemize}\vspace{0.5em}

    \BLOCK{elif section_type == "experience" or section.name|lower == "experience"}
        \BLOCK{for job in section.content}
            \rsubtitle{\VAR{job.title}}{\VAR{job.dates}}
            \rcompany{\VAR{job.company}}
            \begin{itemize}[leftmargin=1.5em,label=\textbullet,itemsep=0.1em,parsep=0pt]
                \BLOCK{for bullet in job.description}
                    \rbullet{\VAR{bullet}}
                \BLOCK{endfor}
            \end{itemize}\vspace{0.4em}
        \BLOCK{endfor}

    \BLOCK{elif section_type == "education" or section.name|lower == "education"}
        \BLOCK{for edu in section.content}
            \rsubtitle{\VAR{edu.degree}}{\VAR{edu.year}}
            \rcompany{\VAR{edu.school}}
            \BLOCK{if edu.field_of_study}
                \small{\VAR{edu.field_of_study}}\vspace{0.1em}
            \BLOCK{endif}
            \vspace{0.4em}
        \BLOCK{endfor}

    \BLOCK{else}
        \textit{Unsupported section type: \VAR{section_type}}\vspace{0.5em}
    \BLOCK{endif}
\BLOCK{endfor}


\end{document}
